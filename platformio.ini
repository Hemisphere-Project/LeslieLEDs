[platformio]
default_envs = m5stack_atoms3

; ========================================
; M5Stack AtomS3 (ESP32-S3) - USB MIDI
; ========================================
[env:m5stack_atoms3]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/55.03.33/platform-espressif32.zip
board = m5stack-atoms3
framework = arduino

; Build flags for USB MIDI support
build_flags = 
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=0
    -DPLATFORM_ATOMS3
    -DUSE_USB_MIDI
    -DCONFIG_ESP32_DEFAULT_CPU_FREQ_MHZ=240

; Libraries
lib_deps = 
    fastled/FastLED@3.10.3
    m5stack/M5Unified@0.2.10
    https://github.com/claudeheintz/LXESP32DMX.git

; Monitor settings
monitor_speed = 115200
upload_speed = 1500000

; ========================================
; M5Stack Core (ESP32) - Serial MIDI
; ========================================
[env:m5core]
platform = espressif32
board = m5stack-core-esp32
framework = arduino

; Build flags for Serial MIDI
build_flags = 
    -DPLATFORM_M5CORE
    -DUSE_SERIAL_MIDI

; Exclude USB MIDI handler from build
build_src_filter = 
    +<*>
    -<midi_handler.cpp>

; Libraries
lib_deps = 
    fastled/FastLED@3.10.3
    m5stack/M5Unified@0.2.10
    https://github.com/claudeheintz/LXESP32DMX.git

; Monitor settings
monitor_speed = 115200
upload_speed = 1500000

; ========================================
; Test Environment - AtomS3 LED test
; ========================================
[env:test_atoms3]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/55.03.33/platform-espressif32.zip
board = m5stack-atoms3
framework = arduino

; Enable serial for test output
build_flags = 
    -DARDUINO_USB_MODE=0
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DPLATFORM_ATOMS3
    -DCONFIG_ESP32_DEFAULT_CPU_FREQ_MHZ=240

; Only FastLED needed for test
lib_deps = 
    fastled/FastLED@3.10.3
    https://github.com/claudeheintz/LXESP32DMX.git

; Compile only test file, exclude everything in src/
build_src_filter = 
    -<src/>
    +<../test/test_leds.cpp>

monitor_speed = 115200
upload_speed = 1500000

; ========================================
; Test Environment - M5Core LED test
; ========================================
[env:test_m5core]
platform = espressif32
board = m5stack-core-esp32
framework = arduino

; Enable serial for test output
build_flags = 
    -DPLATFORM_M5CORE

; Only FastLED needed for test
lib_deps = 
    fastled/FastLED@3.10.3
    https://github.com/claudeheintz/LXESP32DMX.git

; Compile only test file, exclude everything in src/
build_src_filter = 
    -<src/>
    +<../test/test_leds_m5core.cpp>

monitor_speed = 115200
upload_speed = 1500000